<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Qt WebRTC Audio</title>
  <!-- PeerJS client library -->
  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>  <!-- :contentReference[oaicite:0]{index=0} -->
</head>
<body>
  <h3>Qt + PeerJS Audio Call</h3>
  <button id="start">Start Audio</button>
  <div>Your ID: <span id="my-id">â€”</span></div>

  <input id="remote-id" placeholder="Remote Peer ID" />
  <button id="call">Call</button>

  <script>
    let peer, localStream;

    document.getElementById('start').onclick = async () => {
      peer = new Peer();  // uses free PeerServer cloud by default
      peer.on('open', id => document.getElementById('my-id').textContent = id);

      // get mic
      localStream = await navigator.mediaDevices.getUserMedia({ audio: true });

      // answer incoming calls
      peer.on('call', call => {
        call.answer(localStream);
        call.on('stream', remoteStream => {
          const audio = new Audio();
          audio.srcObject = remoteStream;
          audio.play();
        });
      });
    };

    document.getElementById('call').onclick = () => {
      const remoteId = document.getElementById('remote-id').value;
      // initiate call
      const call = peer.call(remoteId, localStream);  // :contentReference[oaicite:1]{index=1}
      call.on('stream', remoteStream => {
        const audio = new Audio();
        audio.srcObject = remoteStream;
        audio.play();
      });
    };
  </script>
</body>
</html>
